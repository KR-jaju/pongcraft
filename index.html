<html>
	<body>
		<canvas id="canvas">Canvas not supported</canvas>
		<script src="graphics/Buffer.js"></script>
		<script src="graphics/Shader.js"></script>
		<script src="graphics/Program.js"></script>
		<script src="graphics/Framebuffer.js"></script>
		<script src="graphics/DefaultFramebuffer.js"></script>
		<script src="graphics/VertexArray.js"></script>
		<script src="graphics/VertexBuffer.js"></script>
		<!--<script type="module" src="graphics/graphics.js"></script>-->
		<script>
			"use strict";
			class Main {
				static gl = null;
				static	vbo_buffer = null;
				static	vbo = null;
				static	vao = null;
				static	program = null;
				static entry() {
					const canvas = document.getElementById("canvas");
					canvas.width = document.body.clientWidth;
					canvas.height = document.body.clientHeight;
					const	gl = canvas.getContext("webgl2");
					if (!gl) {
						alert("Webgl2 not supported!");
					}
					// 크기 대응 필요

					const vs = new Shader(gl, gl.VERTEX_SHADER);
					const fs = new Shader(gl, gl.FRAGMENT_SHADER);
					vs.shaderSource(gl, `#version 300 es

					in vec4	position;
					void	main() {
						gl_Position = position;
					}
					`);
					fs.shaderSource(gl, `#version 300 es
					precision mediump float;
					
					out vec4	fragColor;

					void	main() {
						fragColor = vec4(1.0, 0.0, 0.0, 1.0);
					}
					`);
					vs.compile(gl);
					fs.compile(gl);
					const program = new Program(gl);
					program.attach(gl, vs);
					program.attach(gl, fs);
					program.link(gl);

					const	data = new Float32Array([
						-1, -1, 0,
						1, -1, 0,
						1, 1, 0
					]);
					const	vbo_buffer = new Buffer(gl, gl.ARRAY_BUFFER, 36, gl.STATIC_DRAW);
					// alert(data.length * data.BYTES_PER_ELEMENT);
					vbo_buffer.setData(gl, 0, data, 0, 36);
					// data.length * data.BYTES_PER_ELEMENT);

					const	vbo = new VertexBuffer(gl, vbo_buffer, 3, gl.FLOAT, false);
					const	vao = new VertexArray(gl);
				
					let loc = gl.getAttribLocation(program.id, "position");
					console.log("loc:" + loc);
					// vao.attach(gl, vbo, loc);

					Main.gl = gl;
					Main.program = program;
					Main.vbo_buffer = vbo_buffer;
					Main.vbo = vbo;
					Main.vao = vao;
					Main.gl.clearColor(0.4, 0.4, 0.4, 1.0);
					// gl.viewport(0, 0, canvas.width, canvas.height);
					requestAnimationFrame(Main.update);
				}
				static update() {
					// DefaultFramebuffer.setClearColor(0.4, 0.4, 0.4, 1.0);
					// DefaultFramebuffer.clearColor(Main.gl);
					Main.gl.clear(Main.gl.COLOR_BUFFER_BIT);
					// Main.vao._bind(Main.gl);
					let loc = Main.gl.getAttribLocation(Main.program.id, "position");
					console.log(loc);
					Main.vbo._bind(Main.gl, loc);
					Main.program.use(Main.gl);
					Main.gl.drawArrays(Main.gl.TRAINGLES, 0, 3);
					// Main.vao._unbind(Main.gl);
					// console.log(Main.gl.getError());
					requestAnimationFrame(Main.update);
				}
			}
			requestAnimationFrame(Main.entry);
			// Main.entry();
		</script>
	</body>
</html>